<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø­Ù„Ù„ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ±</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&family=Tajawal:wght@400;500;700&display=swap');
        
        :root {
            --primary: #1a4d7a;
            --primary-dark: #0f3654;
            --secondary: #2ecc71;
            --accent: #e74c3c;
            --bg-main: #f8f9fa;
            --bg-card: #ffffff;
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --border: #e1e8ed;
            --shadow: rgba(0, 0, 0, 0.08);
            --shadow-hover: rgba(0, 0, 0, 0.15);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
            color: var(--text-primary);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            animation: fadeIn 0.6s ease-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        header {
            text-align: center;
            margin-bottom: 3rem;
            animation: slideDown 0.8s ease-out;
            position: relative;
        }
        
        .back-button {
            position: absolute;
            top: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 12px;
            text-decoration: none;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .back-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        h1 {
            font-family: 'Cairo', sans-serif;
            font-size: 3.5rem;
            font-weight: 900;
            color: white;
            text-shadow: 2px 4px 20px rgba(0, 0, 0, 0.3);
            margin-bottom: 0.5rem;
            letter-spacing: -1px;
        }
        
        .subtitle {
            color: rgba(255, 255, 255, 0.95);
            font-size: 1.2rem;
            font-weight: 500;
        }
        
        .main-card {
            background: var(--bg-card);
            border-radius: 24px;
            padding: 2.5rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }
        
        .main-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.25);
        }
        
        .input-section {
            margin-bottom: 2rem;
        }
        
        label {
            display: block;
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 0.75rem;
            color: var(--primary-dark);
        }
        
        textarea {
            width: 100%;
            min-height: 300px;
            padding: 1.5rem;
            border: 3px solid var(--border);
            border-radius: 16px;
            font-family: 'Tajawal', sans-serif;
            font-size: 1rem;
            resize: vertical;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }
        
        textarea:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 4px rgba(26, 77, 122, 0.1);
        }
        
        .btn-container {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        button {
            flex: 1;
            padding: 1.2rem 2rem;
            font-family: 'Cairo', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: 0 8px 20px rgba(26, 77, 122, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(26, 77, 122, 0.4);
        }
        
        .btn-primary:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 3px solid var(--primary);
        }
        
        .btn-secondary:hover {
            background: var(--primary);
            color: white;
        }
        
        .results-section {
            display: none;
            animation: slideUp 0.6s ease-out;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .results-section.show {
            display: block;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            border-radius: 16px;
            padding: 1.8rem;
            border: 2px solid var(--border);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: var(--primary);
            opacity: 0.05;
            border-radius: 0 0 0 100%;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            border-color: var(--primary);
            box-shadow: 0 12px 30px var(--shadow-hover);
        }
        
        .stat-card:hover::before {
            opacity: 0.1;
            width: 150px;
            height: 150px;
        }
        
        .stat-label {
            font-size: 0.95rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        
        .stat-value {
            font-family: 'Cairo', sans-serif;
            font-size: 2.2rem;
            font-weight: 900;
            color: var(--primary);
        }
        
        .stat-unit {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-right: 0.3rem;
        }
        
        .details-table {
            background: var(--bg-card);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px var(--shadow);
        }
        
        .table-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 1.5rem;
            font-family: 'Cairo', sans-serif;
            font-size: 1.3rem;
            font-weight: 700;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead th {
            background: var(--primary);
            color: white;
            padding: 1rem;
            font-weight: 700;
            text-align: center;
            font-size: 0.95rem;
        }
        
        tbody tr {
            border-bottom: 1px solid var(--border);
            transition: background 0.2s ease;
        }
        
        tbody tr:hover {
            background: #f8f9fa;
        }
        
        tbody td {
            padding: 1rem;
            text-align: center;
            font-size: 0.9rem;
        }
        
        tbody td.time-cell {
            direction: ltr;
            text-align: center;
        }
        
        .day-type {
            display: inline-block;
            padding: 0.4rem 0.8rem;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .type-regular { background: #e8f5e9; color: #2e7d32; }
        .type-weekend { background: #f3e5f5; color: #7b1fa2; }
        .type-vacation { background: #fff3e0; color: #e65100; }
        .type-wfh { background: #e3f2fd; color: #1565c0; }
        .type-site { background: #fce4ec; color: #c2185b; }
        .type-holiday { background: #f1f8e9; color: #558b2f; }
        
        .error-message {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin-top: 1rem;
            font-weight: 600;
            text-align: center;
            animation: shake 0.5s ease;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .loading {
            text-align: center;
            padding: 2rem;
        }
        
        .spinner {
            border: 4px solid rgba(26, 77, 122, 0.1);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            body { padding: 1rem; }
            h1 { font-size: 2.5rem; }
            .main-card { padding: 1.5rem; }
            .stats-grid { grid-template-columns: 1fr; }
            .btn-container { flex-direction: column; }
            
            .back-button {
                position: static;
                display: inline-block;
                margin-bottom: 1rem;
                font-size: 0.9rem;
                padding: 0.6rem 1.2rem;
            }
            
            header {
                padding-top: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-button">â† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            <h1>ğŸ“Š Ù…Ø­Ù„Ù„ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ±</h1>
            <p class="subtitle">Ø§Ù„ØµÙ‚ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ³ÙŠØªÙ… ØªØ­Ù„ÙŠÙ„Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</p>
        </header>
        
        <div class="main-card">
            <div class="input-section">
                <label for="reportText">Ø§Ù„ØµÙ‚ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± Ù‡Ù†Ø§:</label>
                <textarea 
                    id="reportText" 
                    placeholder="Ø§Ù„ØµÙ‚ Ù†Øµ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙƒØ§Ù…Ù„ Ù‡Ù†Ø§...

Ù…Ø«Ø§Ù„: Attendance Report January,2026
Employee Name Mohammad Mofreh Mahfouz Alrashidi
..."></textarea>
                
                <div class="btn-container">
                    <button class="btn-primary" onclick="analyzeReport()">ğŸ” ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
                    <button class="btn-secondary" onclick="clearReport()">ğŸ—‘ï¸ Ù…Ø³Ø­</button>
                </div>
            </div>
        </div>
        
        <div class="results-section" id="results">
            <div class="main-card">
                <div class="table-header">ğŸ“ˆ Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠ</div>
                <div class="stats-grid" id="statsGrid"></div>
            </div>
            
            <div class="main-card">
                <div class="details-table">
                    <div class="table-header">ğŸ“… ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ</div>
                    <div id="detailsTable"></div>
                </div>
            </div>
            
            <div class="btn-container">
                <button class="btn-primary" onclick="downloadExcel()">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Excel</button>
                <button class="btn-secondary" onclick="printReport()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
            </div>
        </div>
    </div>

    <script>
        let analysisData = null;
        
        function analyzeReport() {
            const text = document.getElementById('reportText').value.trim();
            
            if (!text) {
                alert('âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù„ØµÙ‚ Ù†Øµ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            
            try {
                const data = parseAttendanceReport(text);
                analysisData = data;
                displayResults(data);
                document.getElementById('results').classList.add('show');
                document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
            } catch (error) {
                alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±. ØªØ£ÙƒØ¯ Ù…Ù† ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØµØ­ÙŠØ­.');
                console.error(error);
            }
        }
        
        function parseAttendanceReport(text) {
            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù - Ø¯Ø¹Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ
            const employeeName = text.match(/(?:Employee Name|Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù)\s*:?\s*([^\n]+)/i)?.[1]?.trim() || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            const employeeId = text.match(/(?:Employee ID|Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ¸ÙŠÙÙŠ)\s*:?\s*(\d+)/i)?.[1] || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            const department = text.match(/(?:Department|Ø§Ù„Ù‚Ø·Ø§Ø¹|Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©)\s*:?\s*([^\n]+)/i)?.[1]?.trim() || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            
            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø´Ù‡Ø± - Ø¯Ø¹Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ
            const monthMatch = text.match(/(?:of|Report|ØªÙ‚Ø±ÙŠØ±)\s+(January|February|March|April|May|June|July|August|September|October|November|December|ÙŠÙ†Ø§ÙŠØ±|ÙØ¨Ø±Ø§ÙŠØ±|Ù…Ø§Ø±Ø³|Ø£Ø¨Ø±ÙŠÙ„|Ù…Ø§ÙŠÙˆ|ÙŠÙˆÙ†ÙŠÙˆ|ÙŠÙˆÙ„ÙŠÙˆ|Ø£ØºØ³Ø·Ø³|Ø³Ø¨ØªÙ…Ø¨Ø±|Ø£ÙƒØªÙˆØ¨Ø±|Ù†ÙˆÙÙ…Ø¨Ø±|Ø¯ÙŠØ³Ù…Ø¨Ø±),?\s*(\d{4})/i);
            const month = monthMatch ? `${monthMatch[1]} ${monthMatch[2]}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            
            // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙŠØ§Ù… - Ø¯Ø¹Ù… Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙˆØ§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
            const days = [];
            const monthNames = {
                'ÙŠÙ†Ø§ÙŠØ±': 'January', 'ÙØ¨Ø±Ø§ÙŠØ±': 'February', 'Ù…Ø§Ø±Ø³': 'March', 'Ø£Ø¨Ø±ÙŠÙ„': 'April',
                'Ù…Ø§ÙŠÙˆ': 'May', 'ÙŠÙˆÙ†ÙŠÙˆ': 'June', 'ÙŠÙˆÙ„ÙŠÙˆ': 'July', 'Ø£ØºØ³Ø·Ø³': 'August',
                'Ø³Ø¨ØªÙ…Ø¨Ø±': 'September', 'Ø£ÙƒØªÙˆØ¨Ø±': 'October', 'Ù†ÙˆÙÙ…Ø¨Ø±': 'November', 'Ø¯ÙŠØ³Ù…Ø¨Ø±': 'December'
            };
            
            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¥Ù„Ù‰ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
            const arabicToEnglish = (str) => {
                const arabicNums = ['Ù ', 'Ù¡', 'Ù¢', 'Ù£', 'Ù¤', 'Ù¥', 'Ù¦', 'Ù§', 'Ù¨', 'Ù©'];
                const englishNums = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];
                let result = str;
                arabicNums.forEach((arabic, index) => {
                    result = result.replace(new RegExp(arabic, 'g'), englishNums[index]);
                });
                return result;
            };
            
            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ù„Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
            const normalizedText = arabicToEnglish(text);
            
            const dayPattern = /(\d{2})\s+(January|February|March|April|May|June|July|August|September|October|November|December|ÙŠÙ†Ø§ÙŠØ±|ÙØ¨Ø±Ø§ÙŠØ±|Ù…Ø§Ø±Ø³|Ø£Ø¨Ø±ÙŠÙ„|Ù…Ø§ÙŠÙˆ|ÙŠÙˆÙ†ÙŠÙˆ|ÙŠÙˆÙ„ÙŠÙˆ|Ø£ØºØ³Ø·Ø³|Ø³Ø¨ØªÙ…Ø¨Ø±|Ø£ÙƒØªÙˆØ¨Ø±|Ù†ÙˆÙÙ…Ø¨Ø±|Ø¯ÙŠØ³Ù…Ø¨Ø±)\s+2026/gi;
            let match;
            
            while ((match = dayPattern.exec(normalizedText)) !== null) {
                const dayNum = parseInt(match[1]);
                let monthName = match[2];
                
                // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø¥Ù„Ù‰ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ
                if (monthNames[monthName]) {
                    monthName = monthNames[monthName];
                }
                
                const dayStart = match.index;
                
                // Ø¥ÙŠØ¬Ø§Ø¯ Ù†Ù‡Ø§ÙŠØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙŠÙˆÙ… (Ù‚Ø¨Ù„ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ)
                let nextDayIndex = normalizedText.length;
                const nextDayMatch = normalizedText.substring(dayStart + 1).match(/\d{2}\s+(January|February|March|April|May|June|July|August|September|October|November|December|ÙŠÙ†Ø§ÙŠØ±|ÙØ¨Ø±Ø§ÙŠØ±|Ù…Ø§Ø±Ø³|Ø£Ø¨Ø±ÙŠÙ„|Ù…Ø§ÙŠÙˆ|ÙŠÙˆÙ†ÙŠÙˆ|ÙŠÙˆÙ„ÙŠÙˆ|Ø£ØºØ³Ø·Ø³|Ø³Ø¨ØªÙ…Ø¨Ø±|Ø£ÙƒØªÙˆØ¨Ø±|Ù†ÙˆÙÙ…Ø¨Ø±|Ø¯ÙŠØ³Ù…Ø¨Ø±)\s+2026/i);
                if (nextDayMatch) {
                    nextDayIndex = dayStart + 1 + nextDayMatch.index;
                }
                
                const dayText = normalizedText.substring(dayStart, nextDayIndex);
                
                // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„ÙŠÙˆÙ… - Ø¯Ø¹Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ
                let type = 'ÙŠÙˆÙ… Ø¹Ù…Ù„ Ø¹Ø§Ø¯ÙŠ';
                
                if (dayText.match(/Weekend|Ø¹Ø·Ù„Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©|Ø¹Ø·Ù„Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹/i)) type = 'Ø¹Ø·Ù„Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹';
                else if (dayText.match(/Working from Home|Ø¹Ù…Ù„ Ù…Ù† Ø§Ù„Ù…Ù†Ø²Ù„/i)) type = 'Ø¹Ù…Ù„ Ù…Ù† Ø§Ù„Ù…Ù†Ø²Ù„';
                else if (dayText.match(/Site Visit|Ø²ÙŠØ§Ø±Ø© Ù…ÙŠØ¯Ø§Ù†ÙŠØ©/i)) type = 'Ø²ÙŠØ§Ø±Ø© Ù…ÙŠØ¯Ø§Ù†ÙŠØ©';
                else if (dayText.match(/Annual Vacation|Ø¥Ø¬Ø§Ø²Ø© Ø³Ù†ÙˆÙŠØ©/i)) type = 'Ø¥Ø¬Ø§Ø²Ø© Ø³Ù†ÙˆÙŠØ©';
                else if (dayText.match(/Half Day Leave|Ø¥Ø¬Ø§Ø²Ø© Ù†ØµÙ ÙŠÙˆÙ…/i)) type = 'Ø¥Ø¬Ø§Ø²Ø© Ù†ØµÙ ÙŠÙˆÙ…';
                else if (dayText.match(/Holiday|Ø¹Ø·Ù„Ø© Ø±Ø³Ù…ÙŠØ©/i)) type = 'Ø¹Ø·Ù„Ø© Ø±Ø³Ù…ÙŠØ©';
                else if (dayText.match(/External Escorting|Ù…Ø±Ø§ÙÙ‚Ø© Ø®Ø§Ø±Ø¬ÙŠØ©/i)) type = 'Ù…Ø±Ø§ÙÙ‚Ø© Ø®Ø§Ø±Ø¬ÙŠØ©';
                
                // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª - Ø¯Ø¹Ù… Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ø±Ø¨ÙŠ (Øµ/Ù…) ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ (AM/PM)
                const timeInArray = [];
                const timeOutArray = [];
                
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù‚Ø³Ù… "ÙˆÙ‚Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬" Ø£Ùˆ "Time in Time out"
                const timeSectionMatch = dayText.match(/(?:ÙˆÙ‚Øª Ø§Ù„Ø¯Ø®ÙˆÙ„\s*ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬|Time in\s*Time out)([\s\S]*?)(?=Ø§Ù„ÙŠÙˆÙ…|Day|Ø§Ù„Ù†ÙˆØ¹|Type|$)/i);
                if (timeSectionMatch) {
                    const timeSectionText = timeSectionMatch[1];
                    
                    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø¨Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ø±Ø¨ÙŠ ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ
                    const timeRegex = /(\d{1,2}:\d{2}\s*(?:[AP]M|Øµ|Ù…))/gi;
                    const timesInSection = [];
                    let tm;
                    while ((tm = timeRegex.exec(timeSectionText)) !== null) {
                        timesInSection.push(tm[1]);
                    }
                    
                    // ØªÙ‚Ø³ÙŠÙ… Ø¥Ù„Ù‰ Ø¯Ø®ÙˆÙ„ ÙˆØ®Ø±ÙˆØ¬
                    for (let i = 0; i < timesInSection.length; i += 2) {
                        if (timesInSection[i]) timeInArray.push(timesInSection[i]);
                        if (timesInSection[i + 1]) timeOutArray.push(timesInSection[i + 1]);
                    }
                }
                
                const timeIn = timeInArray.length > 0 ? timeInArray.join('<br>') : '-';
                const timeOut = timeOutArray.length > 0 ? timeOutArray.join('<br>') : '-';
                
                // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª - Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£ÙŠ Ù†Ù…Ø· XX:XX ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø³Ø·Ø±
                let hours = 0;
                const hoursMatch = dayText.match(/(\d{2}):(\d{2})\s*[\r\n]/);
                if (hoursMatch) {
                    hours = parseFloat(hoursMatch[1]) + parseFloat(hoursMatch[2]) / 60;
                }
                
                // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Ù‚Øµ - Ø¯Ø¹Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ
                let shortage = 0;
                const shortageMatch = dayText.match(/(?:Shortness|Ù†Ù‚Øµ|Ø§Ù„ØªÙ‚ØµÙŠØ±)\s*(\d+)/i);
                if (shortageMatch) {
                    const num = shortageMatch[1];
                    if (num.length >= 4 && num.length % 2 === 0) {
                        const half = num.length / 2;
                        const firstHalf = num.substring(0, half);
                        const secondHalf = num.substring(half);
                        if (firstHalf === secondHalf) {
                            shortage = parseInt(firstHalf);
                        } else {
                            shortage = parseInt(num);
                        }
                    } else {
                        shortage = parseInt(num);
                    }
                }
                
                // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…ÙƒØªØ¨ - Ø¯Ø¹Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ
                let outOfStc = 0;
                const outOfStcMatch = dayText.match(/(?:Out of STC|Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…ÙƒØªØ¨|Ø®Ø§Ø±Ø¬ Ø§Ù„Ø´Ø±ÙƒØ©)\s*(\d+)/i);
                if (outOfStcMatch) {
                    const num = outOfStcMatch[1];
                    if (num.length >= 4 && num.length % 2 === 0) {
                        const half = num.length / 2;
                        const firstHalf = num.substring(0, half);
                        const secondHalf = num.substring(half);
                        if (firstHalf === secondHalf) {
                            outOfStc = parseInt(firstHalf);
                        } else {
                            outOfStc = parseInt(num);
                        }
                    } else {
                        outOfStc = parseInt(num);
                    }
                }
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Øµ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªÙˆØ§Ø¬Ø¯
                let calculatedShortage = 0;
                
                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„ÙŠÙˆÙ… (7 Ø³Ø§Ø¹Ø§Øª ÙŠÙˆÙ…ÙŠØ§Ù‹)
                const expectedHours = (type === 'ÙŠÙˆÙ… Ø¹Ù…Ù„ Ø¹Ø§Ø¯ÙŠ' || 
                                      type === 'Ø²ÙŠØ§Ø±Ø© Ù…ÙŠØ¯Ø§Ù†ÙŠØ©' || 
                                      type === 'Ø¹Ù…Ù„ Ù…Ù† Ø§Ù„Ù…Ù†Ø²Ù„' || 
                                      type === 'Ù…Ø±Ø§ÙÙ‚Ø© Ø®Ø§Ø±Ø¬ÙŠØ©') ? 7 : 0;
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Øµ Ø§Ù„ÙØ¹Ù„ÙŠ
                if (expectedHours > 0 && hours > 0) {
                    const shortageHours = expectedHours - hours;
                    if (shortageHours > 0) {
                        calculatedShortage = Math.round(shortageHours * 60); // ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Ø¯Ù‚Ø§Ø¦Ù‚
                    }
                }
                
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ù‚Øµ Ø§Ù„Ù…Ø­Ø³ÙˆØ¨ Ø£Ùˆ Ø§Ù„Ù†Ù‚Øµ Ù…Ù† Ø§Ù„ØªÙ‚Ø±ÙŠØ± (Ø£ÙŠÙ‡Ù…Ø§ Ø£ÙƒØ¨Ø±)
                const finalShortage = Math.max(calculatedShortage, shortage);
                
                days.push({ dayNum, monthName, type, timeIn, timeOut, hours, shortage: finalShortage, outOfStc });
            }
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…Ù† Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ÙƒØ±Ø±Ø© - Ù†Ø­ØªÙØ¸ Ø¨Ø¢Ø®Ø± Ø¥Ø¯Ø®Ø§Ù„ Ù„ÙƒÙ„ ÙŠÙˆÙ…
            const uniqueDays = [];
            const seenDays = new Set();
            
            for (let i = days.length - 1; i >= 0; i--) {
                if (!seenDays.has(days[i].dayNum)) {
                    uniqueDays.unshift(days[i]);
                    seenDays.add(days[i].dayNum);
                }
            }
            
            const regularDays = uniqueDays.filter(d => d.type === 'ÙŠÙˆÙ… Ø¹Ù…Ù„ Ø¹Ø§Ø¯ÙŠ').length;
            const siteDays = uniqueDays.filter(d => d.type === 'Ø²ÙŠØ§Ø±Ø© Ù…ÙŠØ¯Ø§Ù†ÙŠØ©').length;
            const wfhDays = uniqueDays.filter(d => d.type === 'Ø¹Ù…Ù„ Ù…Ù† Ø§Ù„Ù…Ù†Ø²Ù„').length;
            const vacationDays = uniqueDays.filter(d => d.type.includes('Ø¥Ø¬Ø§Ø²Ø©')).length;
            const escortDays = uniqueDays.filter(d => d.type === 'Ù…Ø±Ø§ÙÙ‚Ø© Ø®Ø§Ø±Ø¬ÙŠØ©').length;
            
            // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ù…Ù† Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ
            const totalHours = uniqueDays.reduce((sum, day) => sum + day.hours, 0);
            
            // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Øµ (Ø§Ù„Ø³Ø§Ø¹Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ø¨Ø±Ø±Ø©)
            const totalShortageMins = uniqueDays.reduce((sum, day) => sum + day.shortage, 0);
            const unjustifiedHours = totalShortageMins / 60;
            
            // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆÙ‚Øª Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…ÙƒØªØ¨
            const totalOutOfStcMins = uniqueDays.reduce((sum, day) => sum + day.outOfStc, 0);
            const outOfStcHours = totalOutOfStcMins / 60;
            
            // Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© (Ø­Ø§Ù„ÙŠØ§Ù‹ ØµÙØ± - ÙŠÙ…ÙƒÙ† Ø­Ø³Ø§Ø¨Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ø¥Ø°Ø§ Ù„Ø²Ù…)
            const extraMinutes = 0;
            const extraHours = 0;
            
            return {
                employeeName,
                employeeId,
                department,
                month,
                totalHours: totalHours.toFixed(2),
                unjustifiedHours: unjustifiedHours.toFixed(2),
                unjustifiedMinutes: totalShortageMins.toString(),
                extraHours: extraHours.toFixed(2),
                extraMinutes: extraMinutes.toString(),
                outOfStcHours: outOfStcHours.toFixed(2),
                outOfStcMinutes: totalOutOfStcMins.toString(),
                regularDays,
                siteDays,
                wfhDays,
                vacationDays,
                escortDays,
                days: uniqueDays.sort((a, b) => a.dayNum - b.dayNum)
            };
        }
        
        function displayResults(data) {
            // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            const statsHTML = `
                <div class="stat-card">
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ±</div>
                    <div class="stat-value">${data.totalHours} <span class="stat-unit">Ø³Ø§Ø¹Ø©</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©</div>
                    <div class="stat-value">${data.regularDays} <span class="stat-unit">ÙŠÙˆÙ…</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©</div>
                    <div class="stat-value">${data.extraMinutes} <span class="stat-unit">Ø¯Ù‚ÙŠÙ‚Ø©</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…ÙƒØªØ¨</div>
                    <div class="stat-value">${data.outOfStcHours} <span class="stat-unit">Ø³Ø§Ø¹Ø©</span> (${data.outOfStcMinutes} Ø¯Ù‚ÙŠÙ‚Ø©)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Ø§Ù„Ø³Ø§Ø¹Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ø¨Ø±Ø±Ø©</div>
                    <div class="stat-value">${data.unjustifiedHours} <span class="stat-unit">Ø³Ø§Ø¹Ø©</span> (${data.unjustifiedMinutes} Ø¯Ù‚ÙŠÙ‚Ø©)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Ø£ÙŠØ§Ù… Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª</div>
                    <div class="stat-value">${data.vacationDays} <span class="stat-unit">ÙŠÙˆÙ…</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Ø§Ù„Ø¹Ù…Ù„ Ù…Ù† Ø§Ù„Ù…Ù†Ø²Ù„</div>
                    <div class="stat-value">${data.wfhDays} <span class="stat-unit">ÙŠÙˆÙ…</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ©</div>
                    <div class="stat-value">${data.siteDays} <span class="stat-unit">ÙŠÙˆÙ…</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Ø§Ù„Ù…Ø±Ø§ÙÙ‚Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©</div>
                    <div class="stat-value">${data.escortDays} <span class="stat-unit">ÙŠÙˆÙ…</span></div>
                </div>
            `;
            document.getElementById('statsGrid').innerHTML = statsHTML;
            
            // Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙØ§ØµÙŠÙ„
            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„ÙŠÙˆÙ…</th>
                            <th>Ø§Ù„Ù†ÙˆØ¹</th>
                            <th>ÙˆÙ‚Øª Ø§Ù„Ø¯Ø®ÙˆÙ„</th>
                            <th>ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬</th>
                            <th>Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªÙˆØ§Ø¬Ø¯</th>
                            <th>Ù†Ù‚Øµ (Ø¯Ù‚ÙŠÙ‚Ø©)</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            data.days.forEach(day => {
                const typeClass = getTypeClass(day.type);
                const monthNameAr = day.monthName === 'January' ? 'ÙŠÙ†Ø§ÙŠØ±' : 
                                   day.monthName === 'February' ? 'ÙØ¨Ø±Ø§ÙŠØ±' :
                                   day.monthName === 'March' ? 'Ù…Ø§Ø±Ø³' :
                                   day.monthName === 'April' ? 'Ø£Ø¨Ø±ÙŠÙ„' :
                                   day.monthName === 'May' ? 'Ù…Ø§ÙŠÙˆ' :
                                   day.monthName === 'June' ? 'ÙŠÙˆÙ†ÙŠÙˆ' :
                                   day.monthName === 'July' ? 'ÙŠÙˆÙ„ÙŠÙˆ' :
                                   day.monthName === 'August' ? 'Ø£ØºØ³Ø·Ø³' :
                                   day.monthName === 'September' ? 'Ø³Ø¨ØªÙ…Ø¨Ø±' :
                                   day.monthName === 'October' ? 'Ø£ÙƒØªÙˆØ¨Ø±' :
                                   day.monthName === 'November' ? 'Ù†ÙˆÙÙ…Ø¨Ø±' :
                                   day.monthName === 'December' ? 'Ø¯ÙŠØ³Ù…Ø¨Ø±' : day.monthName;
                tableHTML += `
                    <tr>
                        <td>${day.dayNum} ${monthNameAr} 2026</td>
                        <td><span class="day-type ${typeClass}">${day.type}</span></td>
                        <td class="time-cell" style="line-height: 1.8;">${day.timeIn}</td>
                        <td class="time-cell" style="line-height: 1.8;">${day.timeOut}</td>
                        <td>${day.hours > 0 ? day.hours.toFixed(2) : '-'}</td>
                        <td>${day.shortage > 0 ? day.shortage : '-'}</td>
                    </tr>
                `;
            });
            
            tableHTML += `</tbody></table>`;
            document.getElementById('detailsTable').innerHTML = tableHTML;
        }
        
        function getTypeClass(type) {
            if (type === 'ÙŠÙˆÙ… Ø¹Ù…Ù„ Ø¹Ø§Ø¯ÙŠ') return 'type-regular';
            if (type === 'Ø¹Ø·Ù„Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹') return 'type-weekend';
            if (type.includes('Ø¥Ø¬Ø§Ø²Ø©')) return 'type-vacation';
            if (type === 'Ø¹Ù…Ù„ Ù…Ù† Ø§Ù„Ù…Ù†Ø²Ù„') return 'type-wfh';
            if (type === 'Ø²ÙŠØ§Ø±Ø© Ù…ÙŠØ¯Ø§Ù†ÙŠØ©') return 'type-site';
            if (type === 'Ø¹Ø·Ù„Ø© Ø±Ø³Ù…ÙŠØ©') return 'type-holiday';
            if (type === 'Ù…Ø±Ø§ÙÙ‚Ø© Ø®Ø§Ø±Ø¬ÙŠØ©') return 'type-site';
            return 'type-regular';
        }
        
        function clearReport() {
            document.getElementById('reportText').value = '';
            document.getElementById('results').classList.remove('show');
            analysisData = null;
        }
        
        function downloadExcel() {
            if (!analysisData) {
                alert('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØ­Ù…ÙŠÙ„Ù‡Ø§');
                return;
            }
            alert('ğŸ“¥ Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Excel Ù‚Ø±ÙŠØ¨Ø§Ù‹. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.');
        }
        
        function printReport() {
            window.print();
        }
    </script>
</body>
</html>
