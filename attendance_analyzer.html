<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø­Ù„Ù„ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ±</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@200;300;400;500;700;800&family=IBM+Plex+Sans+Arabic:wght@200;300;400;500;600;700&display=swap');
        
        :root {
            --primary: #6B7FD7;
            --primary-dark: #5a6bc4;
            --secondary: #4ecca3;
            --accent: #e76f6f;
            --bg-main: #f7f8fa;
            --bg-card: #ffffff;
            --text-primary: #3d4e61;
            --text-secondary: #6b7c8f;
            --border: #e5e9f0;
            --shadow: rgba(0, 0, 0, 0.06);
            --shadow-hover: rgba(0, 0, 0, 0.12);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'IBM Plex Sans Arabic', 'Tajawal', sans-serif;
            background: linear-gradient(135deg, #6B7FD7 0%, #8B7EC8 100%);
            min-height: 100vh;
            padding: 2rem;
            color: var(--text-primary);
            transition: background 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 30%, rgba(255,255,255,0.08) 0%, transparent 50%),
                        radial-gradient(circle at 80% 70%, rgba(255,255,255,0.05) 0%, transparent 50%);
            pointer-events: none;
            animation: shimmer 20s ease-in-out infinite;
            z-index: 0;
        }
        
        @keyframes shimmer {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        body.dark-mode {
            background: linear-gradient(135deg, #1e2846 0%, #2d3561 50%, #343a5e 100%);
            --bg-main: #1e2532;
            --bg-card: #2a3445;
            --text-primary: #d1dae5;
            --text-secondary: #8f9db0;
            --border: #3d4a5e;
            --shadow: rgba(0, 0, 0, 0.25);
            --shadow-hover: rgba(0, 0, 0, 0.4);
        }
        
        body.dark-mode::before {
            background: radial-gradient(circle at 20% 30%, rgba(107, 127, 215, 0.06) 0%, transparent 50%),
                        radial-gradient(circle at 80% 70%, rgba(139, 126, 200, 0.04) 0%, transparent 50%);
        }
        
        .dark-mode-toggle {
            position: fixed;
            top: 2rem;
            left: 2rem;
            background: rgba(255, 255, 255, 0.12);
            border: 1.5px solid rgba(255, 255, 255, 0.25);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(15px);
            z-index: 1000;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        
        .dark-mode-toggle:hover {
            background: rgba(255, 255, 255, 0.18);
            transform: scale(1.08) rotate(90deg);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            border-color: rgba(255, 255, 255, 0.35);
        }
        
        .dark-mode-toggle:active {
            transform: scale(0.98) rotate(90deg);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            animation: fadeIn 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            z-index: 1;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(25px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        header {
            text-align: center;
            margin-bottom: 3rem;
            animation: slideDown 1s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        
        .back-button {
            position: absolute;
            top: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.12);
            color: white;
            padding: 0.75rem 1.4rem;
            border-radius: 12px;
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(15px);
            border: 1.5px solid rgba(255, 255, 255, 0.25);
        }
        
        .back-button:hover {
            background: rgba(255, 255, 255, 0.18);
            transform: translateX(3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-35px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        h1 {
            font-family: 'Tajawal', sans-serif;
            font-size: 3.2rem;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.98);
            text-shadow: 0 3px 20px rgba(0, 0, 0, 0.2);
            margin-bottom: 0.6rem;
            letter-spacing: -0.3px;
        }
        
        .subtitle {
            color: rgba(255, 255, 255, 0.88);
            font-size: 1.15rem;
            font-weight: 300;
        }
        
        .main-card {
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(15px);
            border-radius: 22px;
            padding: 2.5rem;
            box-shadow: 0 12px 40px var(--shadow);
            margin-bottom: 2rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.15);
            position: relative;
            z-index: 1;
        }
        
        .main-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 16px 50px var(--shadow-hover);
        }
        
        .input-section {
            margin-bottom: 2rem;
        }
        
        label {
            display: block;
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 0.75rem;
            color: var(--primary-dark);
        }
        
        textarea {
            width: 100%;
            min-height: 300px;
            padding: 1.5rem;
            border: 3px solid var(--border);
            border-radius: 16px;
            font-family: 'Tajawal', sans-serif;
            font-size: 1rem;
            resize: vertical;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }
        
        textarea:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 4px rgba(26, 77, 122, 0.1);
        }
        
        .btn-container {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        button {
            flex: 1;
            padding: 1.1rem 2rem;
            font-family: 'Tajawal', sans-serif;
            font-size: 1.05rem;
            font-weight: 600;
            border: none;
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
            letter-spacing: 0.2px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: 0 6px 18px rgba(107, 127, 215, 0.25);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(107, 127, 215, 0.35);
        }
        
        .btn-primary:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }
        
        .btn-secondary:hover {
            background: var(--primary);
            color: white;
        }
        
        .results-section {
            display: none;
            animation: slideUp 0.6s ease-out;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .results-section.show {
            display: block;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            border-radius: 16px;
            padding: 1.8rem;
            border: 2px solid var(--border);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: var(--primary);
            opacity: 0.05;
            border-radius: 0 0 0 100%;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            border-color: var(--primary);
            box-shadow: 0 12px 30px var(--shadow-hover);
        }
        
        .stat-card:hover::before {
            opacity: 0.1;
            width: 150px;
            height: 150px;
        }
        
        .stat-label {
            font-size: 0.95rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        
        .stat-value {
            font-family: 'Cairo', sans-serif;
            font-size: 2.2rem;
            font-weight: 900;
            color: var(--primary);
        }
        
        .stat-unit {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-right: 0.3rem;
        }
        
        .details-table {
            background: var(--bg-card);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px var(--shadow);
        }
        
        .table-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 1.5rem;
            font-family: 'Cairo', sans-serif;
            font-size: 1.3rem;
            font-weight: 700;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        table caption {
            caption-side: top;
            text-align: right;
            padding: 0.8rem 1rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 500;
            background: rgba(107, 127, 215, 0.05);
            border-radius: 8px 8px 0 0;
        }
        
        thead th {
            background: var(--primary);
            color: white;
            padding: 1rem;
            font-weight: 700;
            text-align: center;
            font-size: 0.95rem;
        }
        
        tbody tr {
            border-bottom: 1px solid var(--border);
            transition: background 0.2s ease;
        }
        
        tbody tr:hover {
            background: #f8f9fa;
        }
        
        tbody td {
            padding: 1rem;
            text-align: center;
            font-size: 0.9rem;
        }
        
        tbody td.time-cell {
            direction: ltr;
            text-align: center;
        }
        
        .day-type {
            display: inline-block;
            padding: 0.4rem 0.8rem;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .type-regular { background: #e8f5e9; color: #2e7d32; }
        .type-weekend { background: #f3e5f5; color: #7b1fa2; }
        .type-vacation { background: #fff3e0; color: #e65100; }
        .type-wfh { background: #e3f2fd; color: #1565c0; }
        .type-site { background: #fce4ec; color: #c2185b; }
        .type-holiday { background: #f1f8e9; color: #558b2f; }
        
        .error-message {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin-top: 1rem;
            font-weight: 600;
            text-align: center;
            animation: shake 0.5s ease;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .loading {
            text-align: center;
            padding: 2rem;
        }
        
        .spinner {
            border: 4px solid rgba(26, 77, 122, 0.1);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            body { padding: 1rem; }
            h1 { font-size: 2.5rem; }
            .main-card { padding: 1.5rem; }
            .stats-grid { grid-template-columns: 1fr; }
            .btn-container { flex-direction: column; }
            
            .back-button {
                position: static;
                display: inline-block;
                margin-bottom: 1rem;
                font-size: 0.9rem;
                padding: 0.6rem 1.2rem;
            }
            
            header {
                padding-top: 0;
            }
        }
    </style>
</head>
<body>
    <button class="dark-mode-toggle" onclick="toggleDarkMode()" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†">
        <span id="modeIcon">ğŸŒ™</span>
    </button>
    
    <div class="container">
        <header>
            <a href="index.html" class="back-button">â† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            <h1>ğŸ“Š Ù…Ø­Ù„Ù„ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ±</h1>
            <p class="subtitle">Ø§Ù„ØµÙ‚ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ³ÙŠØªÙ… ØªØ­Ù„ÙŠÙ„Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</p>
        </header>
        
        <div class="main-card">
            <div class="input-section">
                <label for="reportText">Ø§Ù„ØµÙ‚ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± Ù‡Ù†Ø§:</label>
                <textarea 
                    id="reportText" 
                    placeholder="Ø§Ù„ØµÙ‚ Ù†Øµ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙƒØ§Ù…Ù„ Ù‡Ù†Ø§...

Ù…Ø«Ø§Ù„: Attendance Report January,2025
Employee Name ...
..."></textarea>
                
                <div class="btn-container">
                    <button class="btn-primary" onclick="analyzeReport()">ğŸ” ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
                    <button class="btn-secondary" onclick="clearReport()">ğŸ—‘ï¸ Ù…Ø³Ø­</button>
                </div>
            </div>
        </div>
        
        <div class="results-section" id="results">
            <div class="main-card">
                <div class="table-header">ğŸ“ˆ Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠ</div>
                <div class="stats-grid" id="statsGrid"></div>
            </div>
            
            <div class="main-card">
                <div class="details-table">
                    <div class="table-header">ğŸ“… ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ</div>
                    <div id="detailsTable"></div>
                </div>
            </div>
            
            <div class="btn-container">
                <button class="btn-primary" onclick="downloadExcel()">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Excel</button>
                <button class="btn-secondary" onclick="printReport()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
            </div>
        </div>
    </div>

    <script>
        let analysisData = null;
        
        function analyzeReport() {
            const text = document.getElementById('reportText').value.trim();
            
            if (!text) {
                alert('âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù„ØµÙ‚ Ù†Øµ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            
            try {
                const data = parseAttendanceReport(text);
                analysisData = data;
                displayResults(data);
                document.getElementById('results').classList.add('show');
                document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
            } catch (error) {
                alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±. ØªØ£ÙƒØ¯ Ù…Ù† ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØµØ­ÙŠØ­.');
                console.error(error);
            }
        }
        
        function parseAttendanceReport(text) {
            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù - Ø¯Ø¹Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ
            const employeeName = text.match(/(?:Employee Name|Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù)\s*:?\s*([^\n]+)/i)?.[1]?.trim() || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            const employeeId = text.match(/(?:Employee ID|Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ¸ÙŠÙÙŠ)\s*:?\s*(\d+)/i)?.[1] || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            const department = text.match(/(?:Department|Ø§Ù„Ù‚Ø·Ø§Ø¹|Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©)\s*:?\s*([^\n]+)/i)?.[1]?.trim() || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            
            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¥Ù„Ù‰ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
            const arabicToEnglish = (str) => {
                const arabicNums = ['Ù ', 'Ù¡', 'Ù¢', 'Ù£', 'Ù¤', 'Ù¥', 'Ù¦', 'Ù§', 'Ù¨', 'Ù©'];
                const englishNums = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];
                let result = str;
                arabicNums.forEach((arabic, index) => {
                    result = result.replace(new RegExp(arabic, 'g'), englishNums[index]);
                });
                return result;
            };
            
            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
            const normalizedText = arabicToEnglish(text);
            
            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø´Ù‡Ø± ÙˆØ§Ù„Ø³Ù†Ø© - Ø¯Ø¹Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ Ù…Ø¹ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
            // Ø¯Ø¹Ù… Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª: "ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø¥Ù†ØµØ±Ø§Ù ÙØ¨Ø±Ø§ÙŠØ±ØŒÙ¢Ù Ù¢Ù¦" Ùˆ "Attendance Report January,2026"
            const monthMatch = normalizedText.match(/(January|February|March|April|May|June|July|August|September|October|November|December|ÙŠÙ†Ø§ÙŠØ±|ÙØ¨Ø±Ø§ÙŠØ±|Ù…Ø§Ø±Ø³|Ø£Ø¨Ø±ÙŠÙ„|Ù…Ø§ÙŠÙˆ|ÙŠÙˆÙ†ÙŠÙˆ|ÙŠÙˆÙ„ÙŠÙˆ|Ø£ØºØ³Ø·Ø³|Ø³Ø¨ØªÙ…Ø¨Ø±|Ø£ÙƒØªÙˆØ¨Ø±|Ù†ÙˆÙÙ…Ø¨Ø±|Ø¯ÙŠØ³Ù…Ø¨Ø±)[ØŒ,]?\s*(\d{4})/i);
            
            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø³Ù†Ø© Ù…Ù† Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            let reportYear = monthMatch ? parseInt(monthMatch[2]) : new Date().getFullYear();
            const month = monthMatch ? `${monthMatch[1]} ${reportYear}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¹Ø§Ù… ÙˆÙ„ÙƒÙ† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø³Ø§Ø¨Ù‚
            // Ù†ÙØªØ±Ø¶ Ø£Ù† Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ù„Ù„Ø³Ù†Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
            const currentDate = new Date();
            const currentMonth = currentDate.getMonth(); // 0-11
            const currentYear = currentDate.getFullYear();
            
            // Ø¥Ø°Ø§ Ù†Ø­Ù† ÙÙŠ Ø¯ÙŠØ³Ù…Ø¨Ø± ÙˆØ§Ù„ØªÙ‚Ø±ÙŠØ± Ù„Ù€ ÙŠÙ†Ø§ÙŠØ±ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
            if (currentMonth === 11 && monthMatch && monthMatch[1].match(/January|ÙŠÙ†Ø§ÙŠØ±/i)) {
                reportYear = currentYear + 1;
            }
            // Ø¥Ø°Ø§ Ù†Ø­Ù† ÙÙŠ ÙŠÙ†Ø§ÙŠØ± ÙˆØ§Ù„ØªÙ‚Ø±ÙŠØ± Ù„Ù€ Ø¯ÙŠØ³Ù…Ø¨Ø±ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
            else if (currentMonth === 0 && monthMatch && monthMatch[1].match(/December|Ø¯ÙŠØ³Ù…Ø¨Ø±/i)) {
                reportYear = currentYear - 1;
            }
            
            // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙŠØ§Ù… - Ø¯Ø¹Ù… Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙˆØ§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
            const days = [];
            const monthNames = {
                'ÙŠÙ†Ø§ÙŠØ±': 'January', 'ÙØ¨Ø±Ø§ÙŠØ±': 'February', 'Ù…Ø§Ø±Ø³': 'March', 'Ø£Ø¨Ø±ÙŠÙ„': 'April',
                'Ù…Ø§ÙŠÙˆ': 'May', 'ÙŠÙˆÙ†ÙŠÙˆ': 'June', 'ÙŠÙˆÙ„ÙŠÙˆ': 'July', 'Ø£ØºØ³Ø·Ø³': 'August',
                'Ø³Ø¨ØªÙ…Ø¨Ø±': 'September', 'Ø£ÙƒØªÙˆØ¨Ø±': 'October', 'Ù†ÙˆÙÙ…Ø¨Ø±': 'November', 'Ø¯ÙŠØ³Ù…Ø¨Ø±': 'December'
            };
            
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø© Ø£Ùˆ Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙŠ Ù†Ù…Ø· Ø§Ù„Ø¨Ø­Ø«
            const dayPattern = new RegExp(`(\\d{2})\\s+(January|February|March|April|May|June|July|August|September|October|November|December|ÙŠÙ†Ø§ÙŠØ±|ÙØ¨Ø±Ø§ÙŠØ±|Ù…Ø§Ø±Ø³|Ø£Ø¨Ø±ÙŠÙ„|Ù…Ø§ÙŠÙˆ|ÙŠÙˆÙ†ÙŠÙˆ|ÙŠÙˆÙ„ÙŠÙˆ|Ø£ØºØ³Ø·Ø³|Ø³Ø¨ØªÙ…Ø¨Ø±|Ø£ÙƒØªÙˆØ¨Ø±|Ù†ÙˆÙÙ…Ø¨Ø±|Ø¯ÙŠØ³Ù…Ø¨Ø±)\\s+${reportYear}`, 'gi');
            let match;
            
            while ((match = dayPattern.exec(normalizedText)) !== null) {
                const dayNum = parseInt(match[1]);
                let monthName = match[2];
                
                // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø¥Ù„Ù‰ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ
                if (monthNames[monthName]) {
                    monthName = monthNames[monthName];
                }
                
                const dayStart = match.index;
                
                // Ø¥ÙŠØ¬Ø§Ø¯ Ù†Ù‡Ø§ÙŠØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙŠÙˆÙ… (Ù‚Ø¨Ù„ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ)
                let nextDayIndex = normalizedText.length;
                const nextDayPattern = new RegExp(`\\d{2}\\s+(January|February|March|April|May|June|July|August|September|October|November|December|ÙŠÙ†Ø§ÙŠØ±|ÙØ¨Ø±Ø§ÙŠØ±|Ù…Ø§Ø±Ø³|Ø£Ø¨Ø±ÙŠÙ„|Ù…Ø§ÙŠÙˆ|ÙŠÙˆÙ†ÙŠÙˆ|ÙŠÙˆÙ„ÙŠÙˆ|Ø£ØºØ³Ø·Ø³|Ø³Ø¨ØªÙ…Ø¨Ø±|Ø£ÙƒØªÙˆØ¨Ø±|Ù†ÙˆÙÙ…Ø¨Ø±|Ø¯ÙŠØ³Ù…Ø¨Ø±)\\s+${reportYear}`, 'i');
                const nextDayMatch = normalizedText.substring(dayStart + 1).match(nextDayPattern);
                if (nextDayMatch) {
                    nextDayIndex = dayStart + 1 + nextDayMatch.index;
                }
                
                const dayText = normalizedText.substring(dayStart, nextDayIndex);
                
                // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„ÙŠÙˆÙ… - Ø¯Ø¹Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ
                let type = 'ÙŠÙˆÙ… Ø¹Ù…Ù„ Ø¹Ø§Ø¯ÙŠ';
                
                if (dayText.match(/Weekend|Ø¹Ø·Ù„Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©|Ø¹Ø·Ù„Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹/i)) type = 'Ø¹Ø·Ù„Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹';
                else if (dayText.match(/Working from Home|Ø¹Ù…Ù„ Ù…Ù† Ø§Ù„Ù…Ù†Ø²Ù„/i)) type = 'Ø¹Ù…Ù„ Ù…Ù† Ø§Ù„Ù…Ù†Ø²Ù„';
                else if (dayText.match(/Site Visit|Ø²ÙŠØ§Ø±Ø© Ù…ÙŠØ¯Ø§Ù†ÙŠØ©/i)) type = 'Ø²ÙŠØ§Ø±Ø© Ù…ÙŠØ¯Ø§Ù†ÙŠØ©';
                else if (dayText.match(/Annual Vacation|Ø¥Ø¬Ø§Ø²Ø© Ø³Ù†ÙˆÙŠØ©/i)) type = 'Ø¥Ø¬Ø§Ø²Ø© Ø³Ù†ÙˆÙŠØ©';
                else if (dayText.match(/Half Day Leave|Ø¥Ø¬Ø§Ø²Ø© Ù†ØµÙ ÙŠÙˆÙ…/i)) type = 'Ø¥Ø¬Ø§Ø²Ø© Ù†ØµÙ ÙŠÙˆÙ…';
                else if (dayText.match(/Holiday|Ø¹Ø·Ù„Ø© Ø±Ø³Ù…ÙŠØ©/i)) type = 'Ø¹Ø·Ù„Ø© Ø±Ø³Ù…ÙŠØ©';
                else if (dayText.match(/External Escorting|Ù…Ø±Ø§ÙÙ‚Ø© Ø®Ø§Ø±Ø¬ÙŠØ©/i)) type = 'Ù…Ø±Ø§ÙÙ‚Ø© Ø®Ø§Ø±Ø¬ÙŠØ©';
                
                // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª - Ø¯Ø¹Ù… Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ø±Ø¨ÙŠ (Øµ/Ù…) ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ (AM/PM)
                const timeInArray = [];
                const timeOutArray = [];
                
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù‚Ø³Ù… "ÙˆÙ‚Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬" Ø£Ùˆ "Time in Time out"
                const timeSectionMatch = dayText.match(/(?:ÙˆÙ‚Øª Ø§Ù„Ø¯Ø®ÙˆÙ„\s*ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬|Time in\s*Time out)([\s\S]*?)(?=Ø§Ù„ÙŠÙˆÙ…|Day|Ø§Ù„Ù†ÙˆØ¹|Type|$)/i);
                if (timeSectionMatch) {
                    const timeSectionText = timeSectionMatch[1];
                    
                    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø¨Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ø±Ø¨ÙŠ ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ
                    const timeRegex = /(\d{1,2}:\d{2}\s*(?:[AP]M|Øµ|Ù…))/gi;
                    const timesInSection = [];
                    let tm;
                    while ((tm = timeRegex.exec(timeSectionText)) !== null) {
                        timesInSection.push(tm[1]);
                    }
                    
                    // ØªÙ‚Ø³ÙŠÙ… Ø¥Ù„Ù‰ Ø¯Ø®ÙˆÙ„ ÙˆØ®Ø±ÙˆØ¬
                    for (let i = 0; i < timesInSection.length; i += 2) {
                        if (timesInSection[i]) timeInArray.push(timesInSection[i]);
                        if (timesInSection[i + 1]) timeOutArray.push(timesInSection[i + 1]);
                    }
                }
                
                const timeIn = timeInArray.length > 0 ? timeInArray.join('<br>') : '-';
                const timeOut = timeOutArray.length > 0 ? timeOutArray.join('<br>') : '-';
                
                // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªÙˆØ§Ø¬Ø¯ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØªØ±Ø§Øª (Ø¯Ø®ÙˆÙ„ ÙˆØ®Ø±ÙˆØ¬)
                let hours = 0;
                
                // Ø£ÙˆÙ„Ø§Ù‹: Ø­Ø³Ø§Ø¨ Ù…Ù† Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø© Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ø°Ø§ ÙˆÙØ¬Ø¯Øª
                if (timeInArray.length > 0 && timeOutArray.length > 0) {
                    const parseTime = (timeStr) => {
                        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙˆÙ‚Øª Ø¥Ù„Ù‰ Ø¯Ù‚Ø§Ø¦Ù‚
                        const normalized = timeStr.trim()
                            .replace(/Øµ/g, 'AM')
                            .replace(/Ù…/g, 'PM');
                        const match = normalized.match(/(\d{1,2}):(\d{2})\s*(AM|PM)?/i);
                        if (!match) return null;
                        let h = parseInt(match[1]);
                        const m = parseInt(match[2]);
                        const period = match[3] ? match[3].toUpperCase() : null;
                        if (period === 'PM' && h !== 12) h += 12;
                        if (period === 'AM' && h === 12) h = 0;
                        return h * 60 + m;
                    };
                    
                    for (let i = 0; i < Math.min(timeInArray.length, timeOutArray.length); i++) {
                        const inMins = parseTime(timeInArray[i]);
                        const outMins = parseTime(timeOutArray[i]);
                        if (inMins !== null && outMins !== null && outMins > inMins) {
                            hours += (outMins - inMins) / 60;
                        }
                    }
                }
                
                // Ø«Ø§Ù†ÙŠØ§Ù‹: Ø¥Ø°Ø§ Ù„Ù… ØªÙØ­Ø³Ø¨ Ù…Ù† Ø§Ù„Ø£ÙˆÙ‚Ø§ØªØŒ Ø§Ø³ØªØ®Ø±Ø¬ Ù…Ù† Ù†Ù…Ø· XX:XX ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø³Ø·Ø±
                if (hours === 0) {
                    const allHoursMatches = [...dayText.matchAll(/(\d{2}):(\d{2})\s*[\r\n]/g)];
                    for (const m of allHoursMatches) {
                        const h = parseInt(m[1]);
                        const min = parseInt(m[2]);
                        // ØªØ£ÙƒØ¯ Ø£Ù†Ù‡ Ø³Ø§Ø¹Ø§Øª ØªÙˆØ§Ø¬Ø¯ ÙˆÙ„ÙŠØ³ ÙˆÙ‚Øª Ø¯Ø®ÙˆÙ„/Ø®Ø±ÙˆØ¬ (Ø£Ù‚Ù„ Ù…Ù† 24 Ø³Ø§Ø¹Ø©)
                        if (h < 24 && min < 60) {
                            hours += h + min / 60;
                        }
                    }
                }
                
                // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Ù‚Øµ - Ø¯Ø¹Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ
                let shortage = 0;
                const shortageMatch = dayText.match(/(?:Shortness|Ù†Ù‚Øµ|Ø§Ù„ØªÙ‚ØµÙŠØ±)\s*(\d+)/i);
                if (shortageMatch) {
                    const num = shortageMatch[1];
                    if (num.length >= 4 && num.length % 2 === 0) {
                        const half = num.length / 2;
                        const firstHalf = num.substring(0, half);
                        const secondHalf = num.substring(half);
                        if (firstHalf === secondHalf) {
                            shortage = parseInt(firstHalf);
                        } else {
                            shortage = parseInt(num);
                        }
                    } else {
                        shortage = parseInt(num);
                    }
                }
                
                // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…ÙƒØªØ¨ - Ø¯Ø¹Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ
                let outOfOffice = 0;
                const outOfOfficeMatch = dayText.match(/(?:Out of Office|Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…ÙƒØªØ¨|Ø®Ø§Ø±Ø¬ Ø§Ù„Ø´Ø±ÙƒØ©)\s*(\d+)/i);
                if (outOfOfficeMatch) {
                    const num = outOfOfficeMatch[1];
                    if (num.length >= 4 && num.length % 2 === 0) {
                        const half = num.length / 2;
                        const firstHalf = num.substring(0, half);
                        const secondHalf = num.substring(half);
                        if (firstHalf === secondHalf) {
                            outOfOffice = parseInt(firstHalf);
                        } else {
                            outOfOffice = parseInt(num);
                        }
                    } else {
                        outOfOffice = parseInt(num);
                    }
                }
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Øµ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªÙˆØ§Ø¬Ø¯
                let calculatedShortage = 0;
                
                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„ÙŠÙˆÙ… (8 Ø³Ø§Ø¹Ø§Øª ÙŠÙˆÙ…ÙŠØ§Ù‹)
                // Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ø³Ù†ÙˆÙŠØ© ÙˆØ§Ù„Ù…Ø±Ø§ÙÙ‚Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© Ù„Ø§ ØªÙØ­Ø³Ø¨ Ø¶Ù…Ù† Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ù…Ù„
                const expectedHours = (type === 'ÙŠÙˆÙ… Ø¹Ù…Ù„ Ø¹Ø§Ø¯ÙŠ' || 
                                      type === 'Ø²ÙŠØ§Ø±Ø© Ù…ÙŠØ¯Ø§Ù†ÙŠØ©' || 
                                      type === 'Ø¹Ù…Ù„ Ù…Ù† Ø§Ù„Ù…Ù†Ø²Ù„') ? 8 : 0;
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Øµ: Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠÙˆÙ… Ø¹Ù…Ù„ØŒ Ù†Ø­Ø³Ø¨ Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ÙˆØ§Ù„ÙØ¹Ù„ÙŠ
                // Ø­ØªÙ‰ Ù„Ùˆ ÙƒØ§Ù†Øª Ø§Ù„Ø³Ø§Ø¹Ø§Øª ØµÙØ± (ØºØ§Ø¦Ø¨ Ø¨Ø¯ÙˆÙ† Ù…Ø¨Ø±Ø±)
                if (expectedHours > 0) {
                    const shortageHours = expectedHours - hours;
                    if (shortageHours > 0) {
                        calculatedShortage = Math.round(shortageHours * 60); // ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Ø¯Ù‚Ø§Ø¦Ù‚
                    }
                }
                
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ù‚Øµ Ø§Ù„Ù…Ø­Ø³ÙˆØ¨ Ø£Ùˆ Ø§Ù„Ù†Ù‚Øµ Ù…Ù† Ø§Ù„ØªÙ‚Ø±ÙŠØ± (Ø£ÙŠÙ‡Ù…Ø§ Ø£ÙƒØ¨Ø±)
                const finalShortage = Math.max(calculatedShortage, shortage);
                
                days.push({ dayNum, monthName, type, timeIn, timeOut, hours, shortage: finalShortage, outOfOffice });
            }
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…Ù† Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ÙƒØ±Ø±Ø© - Ù†Ø­ØªÙØ¸ Ø¨Ø¢Ø®Ø± Ø¥Ø¯Ø®Ø§Ù„ Ù„ÙƒÙ„ ÙŠÙˆÙ…
            const uniqueDays = [];
            const seenDays = new Set();
            
            for (let i = days.length - 1; i >= 0; i--) {
                if (!seenDays.has(days[i].dayNum)) {
                    uniqueDays.unshift(days[i]);
                    seenDays.add(days[i].dayNum);
                }
            }
            
            // Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ Ù…Ù† Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ù…Ù† Ù†ÙØ³ Ø§Ù„Ø´Ù‡Ø± ÙˆØ§Ù„Ø³Ù†Ø©
            const currentDay = currentDate.getDate();
            
            // ØªØ­Ø¯ÙŠØ¯ Ø´Ù‡Ø± Ø§Ù„ØªÙ‚Ø±ÙŠØ±
            const reportMonthMatch = month.match(/(January|February|March|April|May|June|July|August|September|October|November|December|ÙŠÙ†Ø§ÙŠØ±|ÙØ¨Ø±Ø§ÙŠØ±|Ù…Ø§Ø±Ø³|Ø£Ø¨Ø±ÙŠÙ„|Ù…Ø§ÙŠÙˆ|ÙŠÙˆÙ†ÙŠÙˆ|ÙŠÙˆÙ„ÙŠÙˆ|Ø£ØºØ³Ø·Ø³|Ø³Ø¨ØªÙ…Ø¨Ø±|Ø£ÙƒØªÙˆØ¨Ø±|Ù†ÙˆÙÙ…Ø¨Ø±|Ø¯ÙŠØ³Ù…Ø¨Ø±)/i);
            const reportMonthName = reportMonthMatch ? reportMonthMatch[1] : null;
            
            const monthNameToNumber = {
                'January': 0, 'ÙŠÙ†Ø§ÙŠØ±': 0,
                'February': 1, 'ÙØ¨Ø±Ø§ÙŠØ±': 1,
                'March': 2, 'Ù…Ø§Ø±Ø³': 2,
                'April': 3, 'Ø£Ø¨Ø±ÙŠÙ„': 3,
                'May': 4, 'Ù…Ø§ÙŠÙˆ': 4,
                'June': 5, 'ÙŠÙˆÙ†ÙŠÙˆ': 5,
                'July': 6, 'ÙŠÙˆÙ„ÙŠÙˆ': 6,
                'August': 7, 'Ø£ØºØ³Ø·Ø³': 7,
                'September': 8, 'Ø³Ø¨ØªÙ…Ø¨Ø±': 8,
                'October': 9, 'Ø£ÙƒØªÙˆØ¨Ø±': 9,
                'November': 10, 'Ù†ÙˆÙÙ…Ø¨Ø±': 10,
                'December': 11, 'Ø¯ÙŠØ³Ù…Ø¨Ø±': 11
            };
            
            const reportMonth = reportMonthName ? monthNameToNumber[reportMonthName] : -1;
            
            // ØªØµÙÙŠØ© Ø§Ù„Ø£ÙŠØ§Ù…: Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ù…Ù† Ù†ÙØ³ Ø§Ù„Ø´Ù‡Ø± ÙˆØ§Ù„Ø³Ù†Ø©
            const filteredDays = uniqueDays.filter(day => {
                // Ø¥Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ù…Ù† Ù†ÙØ³ Ø§Ù„Ø´Ù‡Ø± ÙˆØ§Ù„Ø³Ù†Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                if (reportMonth === currentMonth && reportYear === currentYear) {
                    // Ø§Ø³ØªØ¨Ø¹Ø¯ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ ÙˆÙ…Ø§ Ø¨Ø¹Ø¯Ù‡ (ÙÙ‚Ø· Ø§Ù„Ø£ÙŠØ§Ù… Ù‚Ø¨Ù„ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ)
                    return day.dayNum < currentDay;
                }
                // Ø¥Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ù…Ù† Ø´Ù‡Ø±/Ø³Ù†Ø© Ù…Ø®ØªÙ„ÙØ©ØŒ Ø§Ø­ØªÙØ¸ Ø¨Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙŠØ§Ù…
                return true;
            });
            
            const regularDays = filteredDays.filter(d => d.type === 'ÙŠÙˆÙ… Ø¹Ù…Ù„ Ø¹Ø§Ø¯ÙŠ').length;
            const siteDays = filteredDays.filter(d => d.type === 'Ø²ÙŠØ§Ø±Ø© Ù…ÙŠØ¯Ø§Ù†ÙŠØ©').length;
            const wfhDays = filteredDays.filter(d => d.type === 'Ø¹Ù…Ù„ Ù…Ù† Ø§Ù„Ù…Ù†Ø²Ù„').length;
            const vacationDays = filteredDays.filter(d => d.type.includes('Ø¥Ø¬Ø§Ø²Ø©')).length;
            const escortDays = filteredDays.filter(d => d.type === 'Ù…Ø±Ø§ÙÙ‚Ø© Ø®Ø§Ø±Ø¬ÙŠØ©').length;
            
            // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ù…Ù† Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ (Ù…Ù† Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ÙÙ„ØªØ±Ø© ÙÙ‚Ø·)
            const totalHours = filteredDays.reduce((sum, day) => sum + day.hours, 0);
            
            // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¯ÙˆØ§Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
            // Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ø³Ù†ÙˆÙŠØ© ÙˆØ§Ù„Ù…Ø±Ø§ÙÙ‚Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© Ù…Ù† Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ù…Ù„
            const workDays = filteredDays.filter(d => 
                d.type === 'ÙŠÙˆÙ… Ø¹Ù…Ù„ Ø¹Ø§Ø¯ÙŠ' || 
                d.type === 'Ø²ÙŠØ§Ø±Ø© Ù…ÙŠØ¯Ø§Ù†ÙŠØ©' || 
                d.type === 'Ø¹Ù…Ù„ Ù…Ù† Ø§Ù„Ù…Ù†Ø²Ù„'
            );
            const totalRequiredHours = workDays.length * 8;
            
            // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Øµ Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚ ÙˆØ§Ù„Ø³Ø§Ø¹Ø§Øª
            const totalShortageMins = filteredDays.reduce((sum, day) => sum + day.shortage, 0);
            const totalShortageHours = totalShortageMins / 60;
            
            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Ù‚Øµ Ø¥Ù„Ù‰ Ø³Ø§Ø¹Ø§Øª:Ø¯Ù‚Ø§Ø¦Ù‚
            const shortageH = Math.floor(totalShortageHours);
            const shortageM = Math.round((totalShortageHours - shortageH) * 60);
            const shortageFormatted = shortageH > 0 
                ? `${shortageH} Ø³ ${shortageM} Ø¯` 
                : `${shortageM} Ø¯`;
            
            // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆÙ‚Øª Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…ÙƒØªØ¨
            const totalOutOfOfficeMins = filteredDays.reduce((sum, day) => sum + day.outOfOffice, 0);
            const outOfOfficeHours = totalOutOfOfficeMins / 60;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© (Ø¥Ø°Ø§ Ø¹Ù…Ù„ Ø£ÙƒØ«Ø± Ù…Ù† 8 Ø³Ø§Ø¹Ø§Øª ÙÙŠ ÙŠÙˆÙ… Ù…Ø§)
            // ÙÙ‚Ø· Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ÙØ¹Ù„ÙŠØ© (Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ø³Ù†ÙˆÙŠØ© ÙˆØ§Ù„Ù…Ø±Ø§ÙÙ‚Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©)
            const extraMins = filteredDays.reduce((sum, day) => {
                if ((day.type === 'ÙŠÙˆÙ… Ø¹Ù…Ù„ Ø¹Ø§Ø¯ÙŠ' || day.type === 'Ø²ÙŠØ§Ø±Ø© Ù…ÙŠØ¯Ø§Ù†ÙŠØ©' || 
                     day.type === 'Ø¹Ù…Ù„ Ù…Ù† Ø§Ù„Ù…Ù†Ø²Ù„') && day.hours > 8) {
                    return sum + Math.round((day.hours - 8) * 60);
                }
                return sum;
            }, 0);
            const extraHours = extraMins / 60;
            
            return {
                employeeName,
                employeeId,
                department,
                month,
                reportYear,
                totalHours: totalHours.toFixed(2),
                totalRequiredHours,
                workDaysCount: workDays.length,
                shortageFormatted,
                totalShortageHours: totalShortageHours.toFixed(2),
                totalShortageMins: totalShortageMins.toString(),
                unjustifiedHours: totalShortageHours.toFixed(2),
                unjustifiedMinutes: totalShortageMins.toString(),
                extraHours: extraHours.toFixed(2),
                extraMinutes: extraMins.toString(),
                outOfOfficeHours: outOfOfficeHours.toFixed(2),
                outOfOfficeMinutes: totalOutOfOfficeMins.toString(),
                regularDays,
                siteDays,
                wfhDays,
                vacationDays,
                escortDays,
                // IMPORTANT: Ø§Ø³ØªØ®Ø¯Ø§Ù… filteredDays Ù‡Ù†Ø§ ÙŠØ¶Ù…Ù† Ø¹Ø¯Ù… Ø¸Ù‡ÙˆØ± Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
                days: filteredDays.sort((a, b) => a.dayNum - b.dayNum),
                excludedCurrentDay: (reportMonth === currentMonth && reportYear === currentYear && filteredDays.length < uniqueDays.length)
            };
        }
        
        function displayResults(data) {
            // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            const statsHTML = `
                <div class="stat-card">
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ±</div>
                    <div class="stat-value">${data.totalHours} <span class="stat-unit">Ø³Ø§Ø¹Ø©</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¯ÙˆØ§Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</div>
                    <div class="stat-value">${data.totalRequiredHours} <span class="stat-unit">Ø³Ø§Ø¹Ø©</span> (${data.workDaysCount} ÙŠÙˆÙ… Ã— 8)</div>
                </div>
                <div class="stat-card" style="border-right: 4px solid #e76f6f;">
                    <div class="stat-label">âš ï¸ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Øµ</div>
                    <div class="stat-value" style="color: #e76f6f;">${data.shortageFormatted} <span class="stat-unit">(${data.totalShortageMins} Ø¯Ù‚ÙŠÙ‚Ø©)</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©</div>
                    <div class="stat-value">${data.extraMinutes} <span class="stat-unit">Ø¯Ù‚ÙŠÙ‚Ø©</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…ÙƒØªØ¨</div>
                    <div class="stat-value">${data.outOfOfficeHours} <span class="stat-unit">Ø³Ø§Ø¹Ø©</span> (${data.outOfOfficeMinutes} Ø¯Ù‚ÙŠÙ‚Ø©)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Ø£ÙŠØ§Ù… Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª</div>
                    <div class="stat-value">${data.vacationDays} <span class="stat-unit">ÙŠÙˆÙ…</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Ø§Ù„Ø¹Ù…Ù„ Ù…Ù† Ø§Ù„Ù…Ù†Ø²Ù„</div>
                    <div class="stat-value">${data.wfhDays} <span class="stat-unit">ÙŠÙˆÙ…</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ©</div>
                    <div class="stat-value">${data.siteDays} <span class="stat-unit">ÙŠÙˆÙ…</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Ø§Ù„Ù…Ø±Ø§ÙÙ‚Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©</div>
                    <div class="stat-value">${data.escortDays} <span class="stat-unit">ÙŠÙˆÙ…</span></div>
                </div>
            `;
            document.getElementById('statsGrid').innerHTML = statsHTML;
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ©
            let noteHTML = `
                <div style="background: rgba(107, 127, 215, 0.1); border-right: 3px solid #6B7FD7; padding: 1rem 1.5rem; border-radius: 8px; margin-top: 1.5rem; font-size: 0.9rem; color: var(--text-secondary);">
                    <strong style="color: var(--text-primary);">ğŸ“Œ Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ø³Ù†ÙˆÙŠØ© ÙˆØ§Ù„Ù…Ø±Ø§ÙÙ‚Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© Ù„Ø§ ØªÙØ­ØªØ³Ø¨ Ø¶Ù…Ù† Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¯ÙˆØ§Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙˆÙ„Ø§ ÙŠÙØ­Ø³Ø¨ Ù„Ù‡Ø§ Ù†Ù‚Øµ.
                </div>
            `;
            
            // Ø¥Ø¶Ø§ÙØ© ØªÙ†Ø¨ÙŠÙ‡ Ø¥Ø°Ø§ ØªÙ… Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ
            if (data.excludedCurrentDay) {
                noteHTML += `
                <div style="background: rgba(255, 193, 7, 0.1); border-right: 3px solid #ffc107; padding: 1rem 1.5rem; border-radius: 8px; margin-top: 1rem; font-size: 0.9rem; color: var(--text-secondary);">
                    <strong style="color: #f59e0b;">â° ØªÙ†Ø¨ÙŠÙ‡:</strong> ØªÙ… Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª (Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØŒ Ø§Ù„Ù†Ù‚ØµØŒ Ø§Ù„Ø³Ø§Ø¹Ø§ØªØŒ ÙˆØ§Ù„Ø¬Ø¯ÙˆÙ„) Ù„Ø£Ù† Ø§Ù„ÙŠÙˆÙ… Ù„Ù… ÙŠÙ†ØªÙ‡ÙŠ Ø¨Ø¹Ø¯. Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ØªØ´Ù…Ù„ ÙÙ‚Ø· Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©.
                </div>
                `;
            }
            
            document.getElementById('statsGrid').insertAdjacentHTML('afterend', noteHTML);
            
            // Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙØ§ØµÙŠÙ„
            let tableHTML = `
                <table>
                    <caption style="caption-side: top; text-align: right; padding: 0.5rem 0; font-size: 0.9rem; color: var(--text-secondary);">
                        Ø¹Ø±Ø¶ ${data.days.length} ${data.days.length === 1 ? 'ÙŠÙˆÙ…' : data.days.length === 2 ? 'ÙŠÙˆÙ…ÙŠÙ†' : 'Ø£ÙŠØ§Ù…'}
                        ${data.excludedCurrentDay ? ' (Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ Ù…Ø³ØªØ¨Ø¹Ø¯)' : ''}
                    </caption>
                    <thead>
                        <tr>
                            <th>Ø§Ù„ÙŠÙˆÙ…</th>
                            <th>Ø§Ù„Ù†ÙˆØ¹</th>
                            <th>ÙˆÙ‚Øª Ø§Ù„Ø¯Ø®ÙˆÙ„</th>
                            <th>ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬</th>
                            <th>Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªÙˆØ§Ø¬Ø¯</th>
                            <th>Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</th>
                            <th>Ø§Ù„Ù†Ù‚Øµ</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            data.days.forEach(day => {
                const typeClass = getTypeClass(day.type);
                const monthNameAr = day.monthName === 'January' ? 'ÙŠÙ†Ø§ÙŠØ±' : 
                                   day.monthName === 'February' ? 'ÙØ¨Ø±Ø§ÙŠØ±' :
                                   day.monthName === 'March' ? 'Ù…Ø§Ø±Ø³' :
                                   day.monthName === 'April' ? 'Ø£Ø¨Ø±ÙŠÙ„' :
                                   day.monthName === 'May' ? 'Ù…Ø§ÙŠÙˆ' :
                                   day.monthName === 'June' ? 'ÙŠÙˆÙ†ÙŠÙˆ' :
                                   day.monthName === 'July' ? 'ÙŠÙˆÙ„ÙŠÙˆ' :
                                   day.monthName === 'August' ? 'Ø£ØºØ³Ø·Ø³' :
                                   day.monthName === 'September' ? 'Ø³Ø¨ØªÙ…Ø¨Ø±' :
                                   day.monthName === 'October' ? 'Ø£ÙƒØªÙˆØ¨Ø±' :
                                   day.monthName === 'November' ? 'Ù†ÙˆÙÙ…Ø¨Ø±' :
                                   day.monthName === 'December' ? 'Ø¯ÙŠØ³Ù…Ø¨Ø±' : day.monthName;
                
                // ØªØ­Ø¯ÙŠØ¯ Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠÙˆÙ… Ø¹Ù…Ù„ ÙŠØªØ·Ù„Ø¨ 8 Ø³Ø§Ø¹Ø§Øª
                // Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ø³Ù†ÙˆÙŠØ© ÙˆØ§Ù„Ù…Ø±Ø§ÙÙ‚Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©
                const isWorkDay = (day.type === 'ÙŠÙˆÙ… Ø¹Ù…Ù„ Ø¹Ø§Ø¯ÙŠ' || 
                                   day.type === 'Ø²ÙŠØ§Ø±Ø© Ù…ÙŠØ¯Ø§Ù†ÙŠØ©' || 
                                   day.type === 'Ø¹Ù…Ù„ Ù…Ù† Ø§Ù„Ù…Ù†Ø²Ù„');
                const required = isWorkDay ? '8:00' : '-';
                
                // ØªÙ†Ø³ÙŠÙ‚ Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªÙˆØ§Ø¬Ø¯
                const hoursH = Math.floor(day.hours);
                const hoursM = Math.round((day.hours - hoursH) * 60);
                const hoursFormatted = day.hours > 0 ? `${hoursH}:${String(hoursM).padStart(2,'0')}` : '-';
                
                // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù†Ù‚Øµ Ø¨ØµÙŠØºØ© Ø³:Ø¯
                let shortageFormatted = '-';
                let shortageStyle = '';
                if (day.shortage > 0) {
                    const sH = Math.floor(day.shortage / 60);
                    const sM = day.shortage % 60;
                    shortageFormatted = sH > 0 
                        ? `${sH}:${String(sM).padStart(2,'0')} Ø³` 
                        : `${sM} Ø¯`;
                    shortageStyle = 'color: #e76f6f; font-weight: 600;';
                }
                
                tableHTML += `
                    <tr>
                        <td>${day.dayNum} ${monthNameAr}</td>
                        <td><span class="day-type ${typeClass}">${day.type}</span></td>
                        <td class="time-cell" style="line-height: 1.8;">${day.timeIn}</td>
                        <td class="time-cell" style="line-height: 1.8;">${day.timeOut}</td>
                        <td>${hoursFormatted}</td>
                        <td>${required}</td>
                        <td style="${shortageStyle}">${shortageFormatted}</td>
                    </tr>
                `;
            });
            
            tableHTML += `</tbody></table>`;
            document.getElementById('detailsTable').innerHTML = tableHTML;
        }
        
        function getTypeClass(type) {
            if (type === 'ÙŠÙˆÙ… Ø¹Ù…Ù„ Ø¹Ø§Ø¯ÙŠ') return 'type-regular';
            if (type === 'Ø¹Ø·Ù„Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹') return 'type-weekend';
            if (type.includes('Ø¥Ø¬Ø§Ø²Ø©')) return 'type-vacation';
            if (type === 'Ø¹Ù…Ù„ Ù…Ù† Ø§Ù„Ù…Ù†Ø²Ù„') return 'type-wfh';
            if (type === 'Ø²ÙŠØ§Ø±Ø© Ù…ÙŠØ¯Ø§Ù†ÙŠØ©') return 'type-site';
            if (type === 'Ø¹Ø·Ù„Ø© Ø±Ø³Ù…ÙŠØ©') return 'type-holiday';
            if (type === 'Ù…Ø±Ø§ÙÙ‚Ø© Ø®Ø§Ø±Ø¬ÙŠØ©') return 'type-site';
            return 'type-regular';
        }
        
        function clearReport() {
            document.getElementById('reportText').value = '';
            document.getElementById('results').classList.remove('show');
            analysisData = null;
        }
        
        function downloadExcel() {
            if (!analysisData) {
                alert('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØ­Ù…ÙŠÙ„Ù‡Ø§');
                return;
            }
            alert('ğŸ“¥ Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Excel Ù‚Ø±ÙŠØ¨Ø§Ù‹. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.');
        }
        
        function printReport() {
            window.print();
        }
        
        // Dark mode functionality
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            document.getElementById('modeIcon').textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
            localStorage.setItem('darkMode', isDark);
        }
        
        // Load saved preference
        window.addEventListener('DOMContentLoaded', () => {
            const isDark = localStorage.getItem('darkMode') === 'true';
            if (isDark) {
                document.body.classList.add('dark-mode');
                document.getElementById('modeIcon').textContent = 'â˜€ï¸';
            }
        });
    </script>
</body>
</html>
